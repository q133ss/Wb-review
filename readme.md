# wbReviewBot

Простой сервис для сбора отзывов/вопросов из маркетплейсов, генерации ответов через ИИ и сохранения истории в БД. Сейчас реализован базовый polling WB и генерация ответа для отзывов с рейтингом 4–5.

## Требования заказчика (из ТЗ)
- Получать вопросы и отзывы через API маркетплейса.
- Отправлять текст в ИИ (промпт предоставляется заказчиком).
- Показывать ответ в интерфейсе и давать возможность редактировать.
- После подтверждения менеджером отправлять ответ через API.
- Хранить историю обращений и ответов.
- Автоответы для 4 и 5 звезд.
- Промпт ИИ редактируется без изменения кода.

## Архитектура и расширяемость
- Коннекторы маркетплейсов лежат в `app/marketplaces/`.
- В БД используется поле `marketplace_id` и уникальность `marketplace + external_id`, поэтому легко подключать Ozon и другие источники.
- Промпт хранится в таблице `settings` и может обновляться через будущий интерфейс.

## Текущий функционал
- Периодический запрос новых отзывов WB (неотвеченные).
- Сохранение отзывов в SQLite.
- Генерация ответа через OpenAI для отзывов с рейтингом 4–5.
- Хранение ответа ИИ и промпта в БД.

## Быстрый старт
```powershell
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
copy .env.example .env
# заполните OPENAI_API_KEY и WB_API_TOKEN в .env
python -m app.seed
python main.py
```

## Конфигурация (.env)
- `OPENAI_API_KEY` — ключ OpenAI.
- `OPENAI_MODEL` — модель (по умолчанию `gpt-4o-mini`).
- `WB_API_TOKEN` — токен WB.
- `DB_PATH` — путь к SQLite (по умолчанию `app.db`).
- `POLL_INTERVAL_SEC` — интервал опроса (по умолчанию 60).
- `PROMPT_TEMPLATE` — шаблон промпта (можно менять без правки кода).

## Схема БД (основное)
- `marketplaces` — список источников (WB, Ozon, ...).
- `feedbacks` — отзывы, статус, ответ ИИ, сырой JSON.
- `settings` — ключ-значение для системных настроек (включая промпт).
